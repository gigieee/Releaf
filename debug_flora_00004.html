<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flora of Thailand</title>
    <link rel="icon" href="images/favicon.ico" type="image/ico" />

    <!-- ( CSS LIBRARY LINKS ) -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/default.css?ver=2.9.1" rel="stylesheet">

    <!-- ( RS5.0 MAIN STYLESHEET ) -->
    <link rel="stylesheet" href="revolution/css/settings.css">
    <!-- RS5.0 LAYERS AND NAVIGATION STYLES -->
    <link rel="stylesheet" href="revolution/css/layers.css">
    <link rel="stylesheet" href="revolution/css/navigation.css">

    <link href="css/mediaQueries.css?ver=2.9.2" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link href="https://fonts.googleapis.com/css?family=Noto+Serif+KR&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css" integrity="sha512-aOG0c6nPNzGk+5zjwyJaoRUgCdOrfSDhmMID2u4+OIslr0GjpLKo7Xm0Ao3xmpM4T8AmIouRkqwj1nrdVsLKEQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="../js_add/fancybox/jquery.fancybox.min.css" rel="stylesheet" type="text/css">



    <style>
        div {
            font-family: 'Noto Serif KR', serif;
        }

        li {
            font-family: 'Noto Serif KR', serif;
        }

        img {
            width: auto;
            height: auto;
        }

        .titletop {
            align-items: center;
        }

        .titletop-item {
            padding: 3rem 3rem 0 3rem;
        }

        br {
            display: block !important;
        }

        #map {
            width: 100%;
            height: 420px;
         
        }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>



</head>
<body>
    <div id="wrapper">
        <header class="header style1">

            <div class="container">
                <div class="head_inner">
                    <div class="logo">
                        <a href="index.html">
                            <img src="images/BKF_logo.gif" alt="" />
                        </a>
                    </div><!-- ( LOGO END ) -->

                </div><!-- ( HEADER INNER END ) -->
            </div>
        </header><!-- ( HEADER END ) -->


        <div id="content" class="productDetail">
            <div class="container">
                <h2>e-Flora of Thailand</h2>
                <div class="stripe">

                    <div id="app">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="input-group">
                                    <!-- @keypress.enter="findinput('family')"
                                    @keyup.prevent="setautocomplete()"

                                    -->
                                    <input type="text" class="form-control" id="tags" autocomplete="off" @keypress.enter="findinput('finddata')" placeholder="Search by taxon names..." @keyup="setautocomplete($event)">
                                    <span class="input-group-btn">
                                        <button class="btn btn-info" type="button" @click.prevent="findinput('finddata')">Go!</button>
                                    </span>
                                </div><!-- /input-group -->
                            </div><!-- /.col-lg-6 -->


                        </div><!-- /.row -->


                        <div id="datafind" class="row" style="margin-top: 10px; margin-bottom: 10px; background-color: #F5FFFF; border-radius: 5px; display: none;">
                            <div class="col-md-3 col-sm-6" v-for="row in records">
                                <div style="padding:5px;">
                                    <p>
                                        <a :href="getlink(row)" target="_blank">
                                            {{row.name}}
                                        </a>

                                    </p>
                                </div>

                            </div>

                        </div>


                    </div>

                </div>
                <div class="stripe" :style="{display:statusdisplay}">
                    <div class="row" id="datadetail">

                    </div><!-- ( ROW END ) -->
                    <div class="row">
                        <div id="divmap" class="col-md-12" style="padding-left: 50px;padding-right: 50px;">
                            <div id="map" style="margin-top:20px;">

                            </div>

                        </div>
                    </div>
                </div><!-- ( STRIPE END ) -->

                <div class="stripe" :style="{display:statusdisplay}">
                    <div class="product-details" id="tabmain" style="display:none;">
                        <div class="tabs_container">
                            <ul class="nav nav-pills" role="tablist">
                                <li role="presentation" class="active" id="tabkey">
                                    <a href="#desc" aria-controls="desc" role="tab" data-toggle="tab">Key</a>
                                </li>
                                <li role="presentation" id="tablower">
                                    <a href="#add-info" aria-controls="add-info" role="tab" data-toggle="tab" id="linktablow">List of lower taxa</a>
                                </li>
                                <li role="presentation" id="tabdrawing">
                                    <a href="#drawing" aria-controls="add-info" role="tab" data-toggle="tab">Drawing</a>
                                </li>
                                <li role="presentation" id="tabimage">
                                    <a href="#imagedata" aria-controls="add-info" role="tab" data-toggle="tab">Image</a>
                                </li>

                                <!--<li role="presentation" id="tablocation">
                                    <a href="#location" aria-controls="add-info" role="tab" data-toggle="tab">Location</a>
                                </li>-->
                                <!--<li role="presentation" id="tabmap">
                                    <a href="#tmap" aria-controls="add-info" role="tab" data-toggle="tab">Map</a>
                                </li>-->

                                <li role="presentation" id="tabcollection">
                                    <a href="#collection" aria-controls="add-info" role="tab" data-toggle="tab">Collection</a>
                                </li>


                            </ul>

                            <div class="tab-content" id="tab-content">
                                <div role="tabpanel" class="tab-pane active" id="desc">

                                    <div id="datakey">

                                    </div>
                                </div>
                                <div role="tabpanel" class="tab-pane" id="add-info">
                                    <div id="datalower">

                                    </div>
                                </div>
                                <div role="tabpanel" class="tab-pane" id="drawing">
                                    <div id="datadrawing" class="row titletop">

                                    </div>
                                </div>
                                <div role="tabpanel" class="tab-pane" id="imagedata">
                                    <div id="dataimage" class="row titletop">

                                    </div>
                                </div>
                                <!--<div role="tabpanel" class="tab-pane" id="location">
                                    <div class="row">
                                        <div class="col-md-12" id="datalocation">

                                        </div>

                                    </div>


                                </div>-->
                                <!--<div role="tabpanel" class="tab-pane" id="tmap">

                                </div>-->
                                <div role="tabpanel" class="tab-pane" id="collection">
                                    <div id="datacollection" class="row titletop">

                                    </div>
                                </div>


                            </div> <!-- ( TAB CONTENT END ) -->
                        </div><!-- ( TABS CONTAINER END ) -->
                    </div><!-- ( PRODUCT DETAILS END ) -->
                </div><!-- ( STRIPE END ) -->
            </div>





        </div><!-- ( CONTENT END ) -->


        <footer class="footer style1">

            <div class="bottom_bar">
                <div class="container">
                    <div class="row">
                        <div class="col-md-7">
                            <ul class="clearfix sepraterLi foterNav">
                                <li><a href="aboutus.html">About us</a></li>
                                <li><a href="contactus.html">Contact us</a></li>
                            </ul><!-- ( FOOTER NAV END ) -->
                            <div class="copyright">
                                <address>
                                    &copy; Forest Herbarium
                                </address>
                                <address>
                                    Department of National Parks, Wildlife and Plant Conservation
                                    61 Phahonyothin Road, Ladyao
                                    Chatuchak, Bangkok 10900
                                </address>
                            </div><!-- ( COPYRIGHT END ) -->
                        </div>
                        <div class="col-md-5">
                            <div class="social_links">

                            </div><!-- ( SOCIAL LINKS END ) -->
                        </div>
                    </div>
                </div>
            </div><!-- ( BOTTOM BAR END ) -->
        </footer><!-- ( FOOTER END ) -->

        <a href="#" class="scroll_top"><i class="fa fa-chevron-up fa-2x"></i></a><!-- ( SCROLL TOP END ) -->

    </div><!-- ( WRAPPER END ) -->
    <span style="color:#e85200;"></span>
    <div class="overlay"></div><!-- ( OVERLAY END ) -->
    <!-- ( JQUERY LIBRARY LINKS ) -->
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/colorbox-min.js"></script>
    <script src="js/isotope.pkgd.min.js"></script>

    <!-- RS5.0 Core JS Files -->
    <script type="text/javascript" src="revolution/js/jquery.themepunch.tools.min.js?rev=5.0"></script>
    <script type="text/javascript" src="revolution/js/jquery.themepunch.revolution.min.js?rev=5.0"></script>

    <script type="text/javascript" src="revolution/js/extensions/revolution.extension.slideanims.min.js"></script>
    <script type="text/javascript" src="revolution/js/extensions/revolution.extension.layeranimation.min.js"></script>
    <script type="text/javascript" src="revolution/js/extensions/revolution.extension.navigation.min.js"></script>
    <script type="text/javascript" src="revolution/js/extensions/revolution.extension.actions.min.js"></script>
    <script type="text/javascript" src="revolution/js/extensions/revolution.extension.video.min.js"></script>

    <!-- share this JS Files -->
    <!--<script type="text/javascript">var switchTo5x = true;</script>
    <script type="text/javascript" src="http://ws.sharethis.com/button/buttons.js"></script>
    <script type="text/javascript">stLight.options({ publisher: "a7c8641b-6c3a-4b59-98ce-510413a4dab4", doNotHash: false, doNotCopy: false, hashAddressBar: false });</script>
    <script type="text/javascript" src="js/lightslider.min.js"></script>
    <script type="text/javascript" src="js/lightgallery.min.js"></script>-->
    <script src="js/jquery.matchHeight-min.js"></script>
    <script src="js/jquery.blockui.min.js"></script>
    <!-- theme custom JS Files -->
    <!---->
    <script src="js/apiserver.js"></script>
    <script src="js/configuration.js"></script>
    <script src="js_other/axios.min.js"></script>
    <script src="js_other/vue.js"></script>

    <script src="../js_add/uglify.js"></script>
    <script src="../js_add/zepto.min.js"></script>
    <script src="../js_add/jquery.magnific-popup.min.js"></script>
    <link href="../css_add/magnific-popup.css" rel="stylesheet" />
    <script src="../js_add/fancybox/jquery.fancybox.min.js"></script><!-- Modernizr -->


    <script>

    </script>
    <script type="text/javascript" src="https://stamen-maps.a.ssl.fastly.net/js/tile.stamen.js?v1.3.0"></script>
    <script src="https://api.longdo.com/map/?key=a49deb1ecafbbd7c69d7b6decc9cdc64"></script>


    <script>



        $(function (event) {


            $.ajaxSetup({
                // Disable caching of AJAX responses
                //cache: false,
                async: false
            });

            $.blockUI({ message: '' });

            //loadmap();

            var geo=[];

            loaddatamap();

            showdatadetail();
            showdatakey();
            showdatalower();
            //showdatalocation();
            showdataimage();
            showdatadrawing();
            showdataCollection();

            let sdatakey = $('#datakey').html();
            let sdatalower = $('#datalower').html();
            let sdatadrawing = $('#datadrawing').html();
            let sdataimage = $('#dataimage').html();
            let sdatacollection = $('#datacollection').html();

            console.log("sdatakey " + sdatakey);
            console.log("sdatalower " + sdatalower);
            console.log("sdatadrawing " + sdatadrawing);
            console.log("sdataimage " + sdataimage);

            if (sdatakey.trim() == "" && sdatalower.trim() == "" && sdatadrawing.trim() == "" && sdataimage.trim() == "" && sdatacollection.trim() == "") {
                $('#tab-content').hide();
            }



            /*
             setTimeout(
                function () {
                   checkdatablank();
                }, 200);
            */




            $.unblockUI();
            //$('#map3').load("map.aspx");


        });

        async function loaddatamap() {

            await loadgeo();
            

            var tdcode = querystring('tdcode');
            console.log(`${apiserver}controller/species/showmapProvince.aspx?tdcode=` + tdcode);


            await $.ajax({
                url: `${apiserver}controller/species/showmapProvince.aspx?tdcode=` + tdcode,
                type: 'GET',
                beforeSend: function () {
                    //$.blockUI();
                },
                success: function (result) {
                    console.log(result)
                    var slistmarker = JSON.parse(result);
                    console.log(slistmarker)
                    if (slistmarker.length > 0) {
                        //loadmap(slistmarker);


                        console.log("showmapProvince")

                        ///loadmapprovince(slistmarker)
                        loaddatamapfloramore(slistmarker);
                        
                    }
                    else {
                        //  $('#divmap').css('display', 'none');
                        loaddatamapflora();
                    }

                },
                timeout: 10000,
                error: onError,
                complete: function () {
                    //$.unblockUI();
                }
            });
        }

        async function loadgeo() {
            
          await  $.ajax({
              url: `${apiserver}controller/species/showprovincemap.aspx`,
                type: 'GET',
                beforeSend: function () {
                    //$.blockUI();
                },
                success: function (result) {
                    //console.log(result)
                    geo = JSON.parse(result);
                    console.log("geo");
                    console.log(geo);
                    //var slistmarker = JSON.parse(result);
                   

                },
                timeout: 10000,
                error: onError,
                complete: function () {
                    //$.unblockUI();
                }
            });
        }



        function loaddatamapfloramore(listmap) {
            var tdcode = querystring('tdcode');
            $.ajax({
                url: `${apiserver}controller/species/showmapfloraProvince.aspx?tdcode=` + tdcode,
                type: 'GET',
                beforeSend: function () {
                    //$.blockUI();
                },
                success: function (result) {
                    console.log(result)
                    var slistmarker = JSON.parse(result);
                    console.log(slistmarker);
                    console.log("listmap");
                    console.log(listmap);

                    let listadd = [];
                    console.log(`slistmarker add ${slistmarker.length}`);
                    if (slistmarker.length > 0) {
                        slistmarker.forEach(e => {
                            //console.log(e.provincemap);
                            let findd = listmap.filter(f => f.provincemap == e.provincemap);
                            console.log(findd.length);
                            if (findd.length == 0) {
                                listadd.push(e);
                            }
                        });
                    }




                    const listall = listmap.concat(listadd);
                    console.log("listall");
                    console.log(listall);



                    if (listall.length > 0) {
                        //loadmap(slistmarker);
                        loadmapprovince(listall)
                        console.log("mapflora")
                    }
                    else {
                        $('#divmap').css('display', 'none');
                    }

                },
                timeout: 10000,
                error: onError,
                complete: function () {
                    //$.unblockUI();
                }
            });
        }

        function loaddatamapflora() {
            var tdcode = querystring('tdcode');
            $.ajax({
                url: `${apiserver}controller/species/showmapfloraProvince.aspx?tdcode=` + tdcode,
                type: 'GET',
                beforeSend: function () {
                    //$.blockUI();
                },
                success: function (result) {
                    console.log(result)
                    var slistmarker = JSON.parse(result);
                    console.log(slistmarker)
                    if (slistmarker.length > 0) {
                        //loadmap(slistmarker);
                        loadmapprovince(slistmarker)
                        console.log("mapflora")
                    }
                    else {
                        $('#divmap').css('display', 'none');
                    }

                },
                timeout: 10000,
                error: onError,
                complete: function () {
                    //$.unblockUI();
                }
            });
        }

       

        function loadmap(slistmarker) {

            var lngcenter = 0;
            var latcenter = 0;

            //var slistmarker = '[{"lat":"6.259185","lng":"102.0529718"},{"lat":"6.8771245","lng":"100.1479182"},{"lat":"7.0086472","lng":"100.4746879"}]';

            //slistmarker = JSON.parse(slistmarker);
            console.log(slistmarker);
            // lngcenter = slistmarker[0].lat;
            // latcenter= slistmarker[0].lng;
            lngcenter = 13.374844859226569;
            latcenter = 100.46780409839329;

            var listmarker = slistmarker;
            //var listmarker = [
            //    { lat: 19.216667, lng: 101.083333 },
            //    { lat: 19.216667, lng: 102.183333},
            //    { lat: 19.316667, lng: 103.183333},
            //];

            /*
            var listmarker = [
                { lat: 19.216667, lng: 101.083333, popname: 'addr1' },
                { lat: 19.216667, lng: 102.183333, popname: 'addr2' },
                { lat: 19.316667, lng: 103.183333, popname: 'addr2' },
            ];
            */


            var grayscale = new L.StamenTileLayer("terrain");
            var streets = new L.StamenTileLayer("terrain-background");



            var map = L.map('map', {
                center: [lngcenter, latcenter],
                zoom: 5,
                layers: [grayscale],
                zoomControl: false
            });

            map.touchZoom.disable();
            map.doubleClickZoom.disable();
            map.scrollWheelZoom.disable();
            map.boxZoom.disable();
            map.keyboard.disable();
            $(".leaflet-control-zoom").css("visibility", "hidden");

            var baseLayers = {
                'terrain': grayscale,
                'terrain background': streets
            };


            var layerControl = L.control.layers(baseLayers).addTo(map);
            //19.216667, 101.083333


            listmarker.forEach((e) => {
                L.marker([e.lat, e.lng]).addTo(map);

            });
        }

        function loadmapprovince(slistmarker) {

            console.log("slistmarker")
            console.log(slistmarker)

            /*
            let listcode = "";
            slistmarker.forEach(e => {
                
                let code = geo.filter(r => r.provincenameeng == e.provincemap);
                if (code.length > 0) {
                    listcode += code[0].provincecode + ";"
                }
            
            })
            */

            const listprovince = slistmarker.map(e => {

                let code = geo.filter(r => r.provincenameeng == e.provincemap);
                return { "maplistcode": code[0].provincecode , ...e}

            })

            /*
            const listprovince = [
                { "maplistcode": listcode}
            ]
            */

            var map;
            map = new longdo.Map({
                placeholder: document.getElementById('map'),
                lastView: false,
                language: 'en',
                zoom: 5,

            });

            //console.log("listprovince")
            //console.log(listprovince)

            listprovince.forEach(e => {
                // var object4 = new longdo.Overlays.Object(e.code, 'IG', {
                // lineColor: null, //สีของเส้น
                // fillColor: 'green'  //สีพื้นหลัง.
                //     title: 'เขตรักษาพันธุ์สัตว์ป่าแม่น้ำภาชี',
                // label: 'เขตรักษาพันธุ์สัตว์ป่าแม่น้ำภาชี', //ข้อความบน object

                let color = "";
                
                // color="#D8542A";
                color = "rgba(200,20,55,0.6)";
                

                let title = "";
                let label = "";
                //title = e.location + '<br> ' + e.province;
                
                var objectmap = new longdo.Overlays.Object(e.maplistcode, 'IG', {
                    combine: true,
                    simplify: 0.00005,
                    ignorefragment: false,
                    lineColor: null, //สีของเส้น
                    fillColor: color,              //สีพื้นหลั
                    title: title,
                    label: label, //ข้อความบน object


                });
                map.Overlays.load(objectmap);

            });

        }

        function checkdatablank() {

            var data = $('#datakey').html();

            if (data.trim() == '') {
                console.log('Blank');

                $('#tabkey').css('display', 'none');
                //$("#linktablow").click();
            }
            else {
                console.log(data);

            }




        }



        function showdatadetail() {


            var factsheet = querystring('factsheet');
            var tdcode = querystring('tdcode');
            var subdoc = querystring('subdoc');

            $.ajax({
                url: `${apiserver}controller/species/showdetailspecies.aspx?factsheet=` + factsheet + "&tdcode=" + tdcode + "&subdoc=" + subdoc,
                type: 'GET',
                beforeSend: function () {
                    //$.blockUI();
                },
                success: function (result) {
                    $('#datadetail').html(result);
                },
                timeout: 10000,
                error: onError,
                complete: function () {
                    //$.unblockUI();
                }
            });



        };

        function showdatakey() {


            var factsheet = querystring('factsheet');
            var tdcode = querystring('tdcode');
            var subdoc = querystring('subdoc');

            $.ajax({
                url: `${apiserver}controller/species/showkeyspeciesdata.aspx?factsheet=` + factsheet + "&tdcode=" + tdcode + "&subdoc=" + subdoc,
                type: 'GET',
                beforeSend: function () {
                    //$.blockUI();
                },
                success: function (result) {


                    if (result.trim() == "") {
                        //$('#tabkey').css('display', 'none');
                        //$("#tablow" ).addClass( "active" );
                        //$("#tabkey").removeClass("active");

                        console.log('no');


                        $('#tabkey').css('display', 'none');
                        $("#linktablow").click();
                    }
                    else {
                        $('#datakey').html(result);
                        console.log(result);
                        console.log('have');
                        $('#tabmain').css('display', 'block');
                    }

                },
                timeout: 10000,
                error: onError,
                complete: function () {
                    //$.unblockUI();
                }
            });



        };

        function showdatalower() {

            var tdcode = querystring('tdcode');
            var factsheet = querystring('factsheet');
            var subdoc = querystring('subdoc');

            $.ajax({
                url: `${apiserver}controller/species/showlowerspecies.aspx?factsheet=` + factsheet + "&tdcode=" + tdcode + "&subdoc=" + subdoc,
                type: 'GET',
                beforeSend: function () {
                    //$.blockUI();
                },
                success: function (result) {

                    if (result == "") {
                        $('#tablower').css('display', 'none');
                    }
                    else {
                        $('#datalower').html(result);
                        $('#tabmain').css('display', 'block');
                    }

                },
                timeout: 10000,
                error: onError,
                complete: function () {
                    //$.unblockUI();
                }
            });



        };

        function showdatalocation() {

            var tdcode = querystring('tdcode');
            var factsheet = querystring('factsheet');

            $.ajax({
                url: `${apiserver}controller/showmap.aspx?type=species&factsheet=` + factsheet + "&tdcode=" + tdcode,
                type: 'GET',
                beforeSend: function () {
                    //$.blockUI();
                },
                success: function (result) {

                    if (result == "") {
                        $('#tablocation').css('display', 'none');
                    }
                    else {
                        $('#datalocation').html(result);
                        $('#tabmain').css('display', 'block');
                    }



                },
                timeout: 10000,
                error: onError,
                complete: function () {
                    //$.unblockUI();
                }
            });



        };


        function showdataimage() {


            var factsheet = querystring('factsheet');
            var tdcode = querystring('tdcode');

            $.ajax({
                url: `${apiserver}controller/species/showfileimage.aspx?factsheet=` + factsheet + "&tdcode=" + tdcode,
                type: 'GET',
                beforeSend: function () {
                    //$.blockUI();
                },
                success: function (result) {

                    if (result == "") {
                        $('#tabimage').css('display', 'none');
                    }
                    else {
                        $('#dataimage').html(result);
                        $('#tabmain').css('display', 'block');
                    }


                },
                timeout: 10000,
                error: onError,
                complete: function () {
                    $('.image-popup-no-margins').magnificPopup({
                        type: 'image',
                        closeOnContentClick: true,
                        closeBtnInside: false,
                        fixedContentPos: true,
                        mainClass: 'mfp-no-margins mfp-with-zoom', // class to remove default margin from left and right side
                        image: {
                            verticalFit: true
                        },
                        zoom: {
                            enabled: true,
                            duration: 300 // don't foget to change the duration also in CSS
                        }
                    });
                    //$.unblockUI();
                }
            });

        };

        function showdatadrawing() {


            var factsheet = querystring('factsheet');
            var tdcode = querystring('tdcode');
            console.log(`${apiserver}controller/species/showfiledrawing.aspx?factsheet=` + factsheet + "&tdcode=" + tdcode);
            $.ajax({
                url: `${apiserver}controller/species/showfiledrawing.aspx?factsheet=` + factsheet + "&tdcode=" + tdcode,
                type: 'GET',
                beforeSend: function () {
                    //$.blockUI();
                },
                success: function (result) {
                    if (result == "") {
                        $('#tabdrawing').css('display', 'none');
                    }
                    else {
                        $('#datadrawing').html(result);
                        $('#tabmain').css('display', 'block');
                    }



                },
                timeout: 10000,
                error: onError,
                complete: function () {
                    $('.image-popup-no-margins').magnificPopup({
                        type: 'image',
                        closeOnContentClick: true,
                        closeBtnInside: false,
                        fixedContentPos: true,
                        mainClass: 'mfp-no-margins mfp-with-zoom', // class to remove default margin from left and right side
                        image: {
                            verticalFit: true
                        },
                        zoom: {
                            enabled: true,
                            duration: 300 // don't foget to change the duration also in CSS
                        }
                    });
                    //$.unblockUI();
                }
            });

        };


        function showdataCollection() {


            var factsheet = querystring('factsheet');
            var tdcode = querystring('tdcode');
            console.log(`${apiserver}controller/species/showcollection.aspx?factsheet=` + factsheet + "&tdcode=" + tdcode);
            $.ajax({
                url: `${apiserver}controller/species/showcollection.aspx?factsheet=` + factsheet + "&tdcode=" + tdcode,
                type: 'GET',
                beforeSend: function () {
                    //$.blockUI();
                },
                success: function (result) {
                    if (result == "") {
                        $('#tabcollection').css('display', 'none');
                    }
                    else {
                        $('#datacollection').html(result);
                        $('#tabmain').css('display', 'block');

                        //wait update
                        //$('#tabmain').css('display', 'block');
                    }



                },
                timeout: 10000,
                error: onError,
                complete: function () {

                }
            });

        };
        /*
        function showdataimage() {

           var tdcode = querystring('tdcode');
           var factsheet = querystring('factsheet');

            console.log("controller/family/showfloraimage.aspx?type=species&factsheet=" + factsheet + "&tdcode=" + tdcode);

           $.ajax({
               url: "controller/family/showfloraimage.aspx?type=species&factsheet=" + factsheet+ "&tdcode="+tdcode,
               type: 'GET',
               beforeSend: function () {
                   //$.blockUI();
               },
               success: function (result) {
                   $('#dataimage').html(result);
               },
               timeout: 10000,
               error: onError,
               complete: function () {
                   //$.unblockUI();
               }
           });
       };
       */


        function onError() {

        }

        function querystring(key) {
            var re = new RegExp('(?:\\?|&)' + key + '=(.*?)(?=&|$)', 'gi');
            var r = [], m;
            while ((m = re.exec(document.location.search)) != null) r.push(m[1]);
            return r;
        }



    </script>

    <script type="text/javascript">
        $(document).ready(function () {

            $('.image-popup-vertical-fit').magnificPopup({
                type: 'image',
                closeOnContentClick: true,
                mainClass: 'mfp-img-mobile',
                image: {
                    verticalFit: true
                }

            });

            $('.image-popup-fit-width').magnificPopup({
                type: 'image',
                closeOnContentClick: true,
                image: {
                    verticalFit: false
                }
            });

            $('.image-popup-no-margins').magnificPopup({
                type: 'image',
                closeOnContentClick: true,
                closeBtnInside: false,
                fixedContentPos: true,
                mainClass: 'mfp-no-margins mfp-with-zoom', // class to remove default margin from left and right side
                image: {
                    verticalFit: true
                },
                zoom: {
                    enabled: true,
                    duration: 300 // don't foget to change the duration also in CSS
                }
            });

        });
    </script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script>


        var app = new Vue({
            el: '#app',
            data: {
                records: [],
                recordsrow: [],
                statusdisplay: "block",
                form: {
                    keyword: ""
                },
                blnshow: false
            },

            methods:
            {

                findinput(typedata) {
                    let skeyword = '';
                    //skeyword = this.form.keyword;
                    skeyword = $("#tags").val();
                    this.getdata(skeyword, typedata);
                },
                getlink(row) {
                    let links = "";

                    if (row.linkname.toLowerCase() == "family") {
                        links = `./florafamily.html?factsheet=${row.name}`;
                    }
                    else if (row.linkname.toLowerCase() == "genus") {
                        if (row.groupcode == "03") {
                            links = `./floraGenus.html?factsheet=${row.Genus}`;
                        }
                        else {
                            links = `./floraGenus.html?factsheet=${row.name}`;
                        }

                    }
                    else if (row.linkname.toLowerCase() == "species") {
                        links = `./floraSpecies.html?tdcode=${row.tdcode}`;
                    }
                    else if (row.linkname.toLowerCase() == "infra") {
                        links = `./florainfra.html?tdcode=${row.tdcode}`;
                    }
                    else if (row.linkname.toLowerCase() == "infra2") {
                        links = `./florainfra2.html?tdcode=${row.tdcode}`;
                    }

                    return links;
                },
                filterData(slink) {

                    this.records = this.recordsrow.filter((e) => {
                        return e.linkname == slink;
                    });
                },
                async getdata(skeyword, typedata) {
                    console.log(`${apiserver}controller/search/showdata.aspx?typedata=${typedata}&keyword=${skeyword}`, timeout = 5000);
                    await axios.post(`${apiserver}controller/search/showdata.aspx?typedata=${typedata}&keyword=${skeyword}`, {
                    }).then(function (res) {
                        app.records = res.data;
                        app.recordsrow = res.data;
                        app.statusdisplay = "none";
                        //app.blnshow = true;
                        $('#datafind').css('display', 'block');
                    });

                }
                ,
                async setautocomplete(event) {

                    if (event.keyCode == 40 || event.keyCode == 38 || event.keyCode == 27 || event.keyCode == 13) {
                        return;
                    }

                    let datalist;
                    var availableTags = [];
                    let skeyword = '';
                    //skeyword = this.form.keyword;
                    skeyword = $("#tags").val();
                    var keydata = document.getElementById('tags').value;
                    //console.log(keydata);

                    //console.log(event.target);
                    //console.log(event.keyCode);
                    //`controller/search/data.json`
                    //`controller/search/showdata.aspx?typedata=autocomplete&keyword=${skeyword}`

                    //console.log(`controller/search/showdata.aspx?typedata=autocomplete&keyword=${skeyword}`);
                    await axios({
                        method: 'get',
                        url: `${apiserver}controller/search/showdata.aspx?typedata=autocomplete&keyword=${skeyword}`,
                        timeout: 50000
                    }).then(await function (res) {
                        datalist = res.data;
                        console.log(datalist)
                        datalist.forEach(e => {
                            availableTags.push({ label: e.name, category: e.linkname });
                        })

                        $("#tags").autocomplete({
                            source: availableTags
                        });
                    });



                }

            },
            created() {
                //this.getdata("", "finddata");
                //this.setautocomplete();


            }
        })

    </script>

</body>
</html>